<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>mailmail</title>
    <style>
        :root { --primary: #4C97FF; --accent: #2b7fff; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background: var(--bg); overflow-x: hidden; }
        
        /* --- ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚¬ãƒ¼ãƒ‰ç”»é¢ --- */
        #mm-auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            z-index: 10000; display: flex; justify-content: center; align-items: center;
        }
        .auth-card {
            background: rgba(255, 255, 255, 0.98); padding: 50px; border-radius: 32px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.2); width: 360px; text-align: center;
            backdrop-filter: blur(10px); animation: fadeIn 0.8s ease;
        }
        .logo-icon {
            width: 70px; height: 70px; background: var(--primary); border-radius: 20px;
            display: flex; justify-content: center; align-items: center; margin: 0 auto 20px;
            box-shadow: 0 10px 20px rgba(76, 151, 255, 0.3); color: white; font-size: 38px; font-weight: 900;
        }
        .auth-card h1 { color: #333; margin: 0; font-size: 28px; font-weight: 800; letter-spacing: -1px; }
        .auth-card input {
            width: 100%; padding: 16px; margin: 10px 0;
            border: 2px solid #f0f3f6; border-radius: 14px; box-sizing: border-box;
            font-size: 16px; outline: none; background: #f8fafc; transition: 0.3s;
        }
        .auth-card input:focus { border-color: var(--primary); background: white; }
        .login-btn {
            width: 100%; padding: 18px; background: var(--primary); color: white;
            border: none; border-radius: 14px; cursor: pointer; font-weight: bold; font-size: 17px; margin-top: 20px;
            box-shadow: 0 10px 25px rgba(76, 151, 255, 0.3); transition: 0.3s;
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(76, 151, 255, 0.4); }

        /* --- ğŸ”“ èªè¨¼å¾Œã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ --- */
        #main-app { display: none; min-height: 100vh; animation: contentSlide 0.6s ease; }
        header { background: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .app-logo { color: var(--primary); font-weight: 900; font-size: 26px; }
        .content-body { padding: 40px; max-width: 1000px; margin: 0 auto; line-height: 1.6; color: #444; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes contentSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<!-- ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
<div id="mm-auth-overlay">
    <div class="auth-card">
        <div class="logo-icon">m</div>
        <h1>mailmail</h1>
        <p id="mm-status" style="font-size:13px; color:#999; margin-top:10px;">ã™ã¹ã¦ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</p>
ã€€ã€€ã€€ã€€<a style="font-size:13px; color:#0000EE; margin-top:10px;"href="https://2015kaito8169/github.io/mailmaildes/">ã“ã®ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸç†ç”±</a>ã€€
		<input type="text" id="mm-id" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID">
        <input type="password" id="mm-pw" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
        <button class="login-btn" onclick="handleLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <p id="mm-status" style="font-size:13px; color:#999; margin-top:10px;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹</p>
		<a href="https://mailmailservice.onrender.com/">æ–°è¦ç™»éŒ²</a>
               <p id="mm-status" style="font-size:13px; color:#999; margin-top:10px;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚Œã¾ã—ãŸã‹</p>
		<a href="https://2015kaito8169.github.io/mailmailpassword/">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¾©å…ƒ</a>
	</div>
</div>

<!-- ğŸ“¦ éš ã—ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã«è¡¨ç¤º) -->
<div id="main-app">
    <header>
        <div class="app-logo">mailmailåˆ†å®¶API</div>
        <div style="display:flex; align-items:center; gap:20px;">
            <span id="user-display" style="font-weight: 800; color: #555;"></span>
            <button onclick="logout()" style="background:#ff4c4c; color:white; border:none; padding:8px 18px; border-radius:10px; cursor:pointer; font-weight:bold;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </header>

    <div class="content-body">
        <!-- â˜… ã“ã“ã«ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¦‹ã›ãŸã„ä¸­èº«ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„ -->
        <!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¿ã‚¤ãƒ”ãƒ³ã‚°Cityï¼</title>
    <script src="https://cdn.unityroom.com"></script>
    <style>
        body { background: linear-gradient(to bottom, #000814, #001f3f); color: #0ff; text-align: center; font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; overflow: hidden; margin: 0; }
        #moon-container { position: fixed; top: 50px; right: 80px; width: 80px; height: 80px; z-index: -2; }
        #moon { width: 100%; height: 100%; background: #ffffcc; border-radius: 50%; box-shadow: 0 0 40px #ffffcc; position: relative; overflow: hidden; }
        #moon-shadow { position: absolute; top: 0; width: 100%; height: 100%; background: #000814; border-radius: 50%; transition: 0.5s; }
        #city-bg { position: fixed; bottom: 0; width: 100%; height: 250px; display: flex; justify-content: space-around; align-items: flex-end; z-index: -1; }
        .building { width: 75px; background: #111; border-top: 2px solid #222; position: relative; }
        .window { width: 14px; height: 14px; background: #050505; margin: 8px auto; transition: 0.3s; border-radius: 2px; }
        .on { background: #fff176; box-shadow: 0 0 15px #fff176; }
        #ui-layer { position: relative; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); }
        .screen { display: none; width: 85%; max-width: 650px; padding: 40px; background: rgba(0,10,20,0.95); border: 3px solid #0ff; border-radius: 15px; box-shadow: 0 0 30px #044; }
        button { background: #003; color: #0ff; border: 2px solid #0ff; padding: 12px 30px; font-size: 22px; cursor: pointer; margin: 10px; border-radius: 5px; transition: 0.2s; }
        button:hover { background: #0ff; color: #000; }
        #word-area { font-size: 50px; margin: 20px; font-weight: bold; letter-spacing: 4px; min-height: 1.2em; font-family: 'Courier New', monospace; }
        #kana-display { font-size: 28px; color: #ffd700; margin-bottom: 10px; }
        #stats { font-size: 20px; margin-bottom: 10px; }
        #power-gauge { width: 100%; height: 25px; border: 2px solid #0ff; margin: 15px 0; background: #000; }
        #power-bar { width: 100%; height: 100%; background: #0ff; transition: 0.1s; }
    </style>
</head>
<body>
    <div id="moon-container"><div id="moon"><div id="moon-shadow"></div></div></div>
    <div id="city-bg"></div>

    <div id="ui-layer">
        <div id="menu-screen" class="screen" style="display: block;">
            <h1>âš¡ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°Cityï¼ âš¡</h1>
            <p id="high-score-text">æœ€é«˜è¨˜éŒ²: 0W</p>
            <p id="total-score-text">ç´¯è¨ˆç™ºé›»é‡: 0W</p>
            <button id="btn-start">å‹¤å‹™é–‹å§‹ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆï¼‰</button><br>
            <button id="btn-record">æ´»å‹•è¨˜éŒ²</button>
            <button id="btn-delete" style="color: #ff4444; border-color: #ff4444; font-size: 16px;">è¨˜éŒ²æŠ¹æ¶ˆ</button>
        </div>
        <div id="story-screen" class="screen">
            <h2>é›»åŠ›å“¡ã¸ã®è¾ä»¤</h2>
            <p style="text-align: left; line-height: 1.8;">æŒ‡å…ˆãŒç”Ÿã‚€ä¸€æ–‡å­—ãŒç«èŠ±ã¨ãªã‚Šã€è¡—ã‚’ç…§ã‚‰ã—ã¾ã™ã€‚é›»åŠ›é‡ãŒã‚¼ãƒ­ã«ãªã‚‹å‰ã«ç™ºé›»ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ï¼</p>
            <button id="btn-story-ok">äº†è§£ã€ç›´ã¡ã«ç™ºé›»ã«å…¥ã‚‹ï¼</button>
        </div>
        <div id="game-screen" class="screen">
            <div id="stats">âš¡ é›»åŠ›é‡: <span id="p-val">100</span>% | ç™ºé›»ä¸­: <span id="s-val">0</span>W</div>
            <div id="power-gauge"><div id="power-bar"></div></div>
            <div id="kana-display"></div>
            <div id="word-area"></div>
        </div>
        <div id="result-screen" class="screen">
            <h2 style="color: #ff4444;">BLACKOUT</h2>
            <p id="final-score" style="font-size: 24px;"></p>
            <button onclick="location.reload()">æœ¬éƒ¨ã¸æˆ»ã‚‹</button>
        </div>
    </div>

    <script>
        const UNITYROOM_API_KEY = "/sSp3O+cEf5Bco80+ESi+TmpCwxlZ0ndsywZzuJzumCrOkkZmSgk5ueG7yYws2j8h0RhIvtU3f7AyxOzWuakRg==";

               const words = [
            {k: "ã—ã‚“ã”ã†", r: ["SHINGOU"]},
            {k: "ã¡ã‹ã¦ã¤", r: ["CHIKATETSU", "TIKATETSU", "CHIKATETU", "TIKATETU"]},
            {k: "ã¤ã†ã—ã‚“", r: ["TSUUSHIN", "TUUSHIN", "TSUUSIN", "TUUSIN"]},
            {k: "ã¯ã¤ã§ã‚“ã", r: ["HATSUDENKI", "HATUDENKI"]},
            {k: "ã§ã‚“ã‚Šã‚‡ã", r: ["DENRYOKU"]},
            {k: "ãµã£ã‹ã¤", r: ["FUKKATSU", "HUKKATSU", "FUKKATU", "HUKKATU"]},
            {k: "ã‚¨ãƒãƒ«ã‚®ãƒ¼", r: ["ENERUGI-"]},
            {k: "ãŸã„ã´ã‚“ã", r: ["TAIPINGU"]},
            {k: "ã¦ã„ã§ã‚“", r: ["TEIDEN"]},
            {k: "ãŒã„ã‚ã¨ã†", r: ["GAIROUTOU"]},
            {k: "ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°", r: ["BIRUDINGU"]},
            {k: "ã“ã†ã˜ã‚‡ã†", r: ["KOUJOU"]},
            {k: "ã“ã†ãˆã‚“", r: ["KOUEN"]},
            {k: "ã§ã‚“ã›ã‚“", r: ["DENSEN"]},
            {k: "ã¸ã‚“ã‚ã¤ã", r: ["HENATSUKI", "HENATUKI"]},
            {k: "ã—ã‚…ã†ã‚Š", r: ["SHUURI", "SYUURI"]},
            {k: "ã¦ã‚“ã‘ã‚“", r: ["TENKEN"]},
            {k: "ãã˜ã‚…ã¤", r: ["GIJUTSU", "GIJUTU"]},
            {k: "ã•ãã‚‡ã†", r: ["SAGYOU"]},
            {k: "ã‹ã‚“ã‚Š", r: ["KANRI"]},
            {k: "ã©ã‚Šã‚‡ã", r: ["DORYOKU"]},
            {k: "ã»ã†ã—ã‚…ã†", r: ["HOUSHUU"]},
            {k: "ã‚·ã‚¹ãƒ†ãƒ ", r: ["SHISUTEMU", "SISUTEMU"]},
            {k: "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯", r: ["NETTO-WA-KU"]},
            {k: "ãƒãƒƒãƒ†ãƒªãƒ¼", r: ["BATTERI-"]},
            {k: "ã‚¿ãƒ¼ãƒ“ãƒ³", r: ["TA-BIN"]},
            {k: "ãƒœãƒ«ãƒˆ", r: ["BORUTO"]},
            {k: "ã‚¢ãƒ³ãƒšã‚¢", r: ["ANPEA"]},
            {k: "ãƒ¯ãƒƒãƒˆ", r: ["WATTO"]},
            {k: "ãã¼ã†", r: ["KIBOU"]},
            {k: "ã¿ã‚‰ã„", r: ["MIRAI"]},
            {k: "ãœã‚“ã‚Šã‚‡ã", r: ["ZENRYOKU"]},
            {k: "ã‚¹ãƒ”ãƒ¼ãƒ‰", r: ["SUPI-DO"]},
            {k: "ã‚ã‚ŠãŒã¨ã†", r: ["ARIGATOU"]}
        ];

        let power = 100, score = 0, speed = 1.0, isPlaying = false, currentWord = {}, typedStr = "";
        let best = parseInt(localStorage.getItem('tc_best') || 0);
        let total = parseInt(localStorage.getItem('tc_total') || 0);

        document.getElementById('moon-shadow').style.left = (Math.random() * 90) + "%";
        const bg = document.getElementById('city-bg');
        for(let i=0; i<8; i++){
            let b = document.createElement('div'); b.className = 'building'; b.style.height = (100 + Math.random()*120) + 'px';
            for(let j=0; j<6; j++) b.innerHTML += '<div class="window"></div>';
            bg.appendChild(b);
        }
        const windows = document.querySelectorAll('.window');

        function updateUI() {
            document.getElementById('p-val').innerText = Math.max(0, Math.floor(power));
            document.getElementById('s-val').innerText = score;
            document.getElementById('power-bar').style.width = power + "%";
            windows.forEach((w, i) => {
                if(power > (i/windows.length)*100) w.classList.add('on');
                else w.classList.remove('on');
            });
            document.getElementById('high-score-text').innerText = `æœ€é«˜è¨˜éŒ²: ${best}W`;
            document.getElementById('total-score-text').innerText = `ç´¯è¨ˆç™ºé›»é‡: ${total}W`;
        }

        function nextWord() {
            currentWord = words[Math.floor(Math.random()*words.length)];
            typedStr = "";
            document.getElementById('kana-display').innerText = currentWord.k;
            renderWord();
        }

        function renderWord() {
            const base = currentWord.r.find(p => p.startsWith(typedStr)) || currentWord.r;
            const remain = base.substring(typedStr.length);
            document.getElementById('word-area').innerHTML = `<span style="color:#fff">${typedStr}</span><span style="color:#444">${remain}</span>`;
        }

        function gameOver() {
            isPlaying = false;
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
    ã€€ã€€ã€€ã€€total += score; if(score > best) best = score;
            localStorage.setItem('tc_best', best); localStorage.setItem('tc_total', total);
            document.getElementById('final-score').innerHTML = `ä»Šå›ã®ç™ºé›»é‡: ${score}W<br>ç´¯è¨ˆç™ºé›»é‡: ${total}W`;

    ã€€ã€€ã€€ã€€ã€€if (typeof unityroom !== 'undefined') {
                unityroom.score.send(1, score, UNITYROOM_API_KEY);
            }
        }

        function gameLoop() {
            if(!isPlaying) return;
            power -= (0.12 * speed); speed += 0.001;
            updateUI();
            if(power <= 0) gameOver();
            else setTimeout(gameLoop, 100);
        }

        document.getElementById('btn-start').onclick = function() {
            document.getElementById('menu-screen').style.display = 'none';
            if(localStorage.getItem('tc_first') === null) {
                document.getElementById('story-screen').style.display = 'block';
            } else {
                startActualGame();
            }
        };

        document.getElementById('btn-story-ok').onclick = startActualGame;
        function startActualGame() {
            localStorage.setItem('tc_first', 'done');
            document.getElementById('story-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            isPlaying = true; nextWord(); gameLoop();
        }

        document.getElementById('btn-record').onclick = function() {
            alert(`ã€é›»åŠ›å“¡ãƒ‡ãƒ¼ã‚¿ã€‘\næœ€é«˜å‡ºåŠ›: ${best}W\nç´¯è¨ˆç™ºé›»é‡: ${total}W`);
        };

        document.getElementById('btn-delete').onclick = function() {
            if(confirm("å…¨è¨˜éŒ²ã‚’æ¶ˆå»ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
                localStorage.clear(); location.reload();
            }
        };

        window.addEventListener('keydown', (e) => {
            if(!isPlaying) return;
            const key = e.key.toUpperCase();
            if(key.length !== 1) return;
            const nextStr = typedStr + key;
            const isMatch = currentWord.r.some(pattern => pattern.startsWith(nextStr));
            if(isMatch) {
                typedStr = nextStr;
                if(currentWord.r.some(pattern => pattern === typedStr)) {
                    score += (typedStr.length * 10); power = Math.min(100, power + 6);
                    nextWord();
                } else { renderWord(); }
            }
            updateUI();
        });

        updateUI();
    </script>
</body>
</html>

        <!-- â˜… ã“ã“ã¾ã§ -->
    </div>
</div>

<script>
    const API_URL = 'https://sparkling-pine-6d7c.kaito20158169.workers.dev';

    // åˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯ (ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶­æŒ)
    (function init() {
        const session = sessionStorage.getItem('mm_access_key');
        if (session) {
            unlockPage(session);
        }
    })();

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function handleLogin() {
        const id = document.getElementById('mm-id').value.trim();
        const pw = document.getElementById('mm-pw').value.trim();
        const status = document.getElementById('mm-status');

        if (!id || !pw) return;

        try {
            // Workerã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ç…§åˆ
            const res = await fetch(`${API_URL}/get?key=auth:${id}`);
            const data = await res.json();

            if (data.value === String(pw)) {
                sessionStorage.setItem('mm_access_key', id);
                unlockPage(id);
            } else {
                status.innerText = "èªè¨¼å¤±æ•—ã€‚IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚";
                status.style.color = "#ff4c4c";
            }
        } catch (e) {
            status.innerText = "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã€‚æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        }
    }

    // ãƒšãƒ¼ã‚¸ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
    function unlockPage(user) {
        document.getElementById('mm-auth-overlay').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('user-display').innerText = "ğŸ‘¤ " + user;
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    function logout() {
        sessionStorage.clear();
        location.reload();
    }
</script>
</body>
</html>
